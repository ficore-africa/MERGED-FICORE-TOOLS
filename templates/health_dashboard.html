<!DOCTYPE html>
<html lang="{{ language if language in ['en', 'ha'] else 'en' }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{{ translations[language]['Track your financial health with Ficore Africa. See your score, earn badges, and get smart insights.'] or 'Track your financial health with Ficore Africa. See your score, earn badges, and get smart insights.' }}">
    <meta name="keywords" content="ficore africa, financial health, dashboard, Africa SME finance, smart insights">
    <meta name="author" content="Ficore Africa">
    <title>{{ translations[language]['Ficore Africa - Your Financial Health Dashboard'] or 'Ficore Africa - Your Financial Health Dashboard' }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #E3F2FD, #F5F7FA);
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            color: #333;
        }
        .container {
            max-width: 1000px;
            margin: auto;
        }
        header {
            background: linear-gradient(45deg, #2E7D32, #0288D1);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            text-align: center;
            color: white;
        }
        .logo-container {
            margin-bottom: 1rem;
        }
        .logo-container img {
            max-width: 200px;
        }
        .progress-tracker {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        .step {
            width: 35px;
            height: 35px;
            background: #E0E0E0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-weight: 600;
            font-size: 1.1rem;
            transition: background 0.3s ease, color 0.3s ease;
        }
        .step.active {
            background: #2E7D32;
            color: white;
        }
        .step.completed {
            background: #0288D1;
            color: white;
        }
        .card {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
            border: 2px solid #0288D1;
            opacity: 0;
            transform: translateY(20px);
            animation: slideIn 0.5s forwards;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .card-header {
            background: linear-gradient(135deg, #2E7D32, #0288D1);
            color: white;
            padding: 1.2rem;
            border-radius: 12px 12px 0 0;
            text-align: center;
            font-weight: 600;
            font-size: 1.8rem;
        }
        .card-body {
            padding: 1.5rem;
        }
        .card-body.light-blue {
            background: #E3F2FD;
        }
        .info-box {
            padding: 12px;
            margin-bottom: 12px;
            font-size: 1rem;
            text-align: center;
            border-radius: 8px;
            background: #F5F7FA;
        }
        .score-box {
            padding: 12px;
            margin-bottom: 12px;
            font-size: 1.1rem;
            text-align: center;
            border-radius: 8px;
            background: #E3F2FD;
            color: #2E7D32;
        }
        .badge-box {
            background: #E3F2FD;
            border: 2px solid #0288D1;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        .learning-box {
            background: #FFF3E0;
            border: 2px solid #0288D1;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
        }
        .tips-list {
            list-style: none;
            padding: 0;
        }
        .tips-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1rem;
            padding: 10px;
            margin-bottom: 10px;
            background: #F5F7FA;
            border-radius: 8px;
        }
        .badge {
            background: #0288D1;
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            margin: 5px;
            font-size: 0.95rem;
            transition: transform 0.3s ease;
            border: 1px solid #01579B;
            cursor: pointer;
        }
        .badge:hover {
            transform: scale(1.1);
        }
        .btn-primary, .btn-secondary, .btn-back {
            padding: 12px 24px;
            font-weight: 600;
            border-radius: 8px;
            font-size: 1rem;
            transition: transform 0.2s ease;
        }
        .btn-primary {
            background: linear-gradient(135deg, #2E7D32, #0288D1);
            border: none;
            color: white;
        }
        .btn-primary:hover {
            transform: scale(1.05);
            background: linear-gradient(135deg, #1B5E20, #01579B);
        }
        .btn-primary:not(.no-arrow)::after {
            content: '→';
            margin-left: 8px;
        }
        .btn-secondary {
            background: linear-gradient(135deg, #B0BEC5, #78909C);
            border: none;
            color: white;
        }
        .btn-secondary:hover {
            transform: scale(1.05);
            background: linear-gradient(135deg, #90A4AE, #607D8B);
        }
        .btn-secondary::after {
            content: '←';
            margin-right: 8px;
        }
        .btn-back {
            background: #6c757d;
            border: none;
            color: white;
        }
        .btn-back:hover {
            transform: scale(1.05);
            background: #5a6268;
        }
        .course-link, .enroll-button {
            padding: 10px 20px;
            font-weight: 600;
            border-radius: 8px;
            font-size: 0.95rem;
            background: #0288D1;
            color: white;
            text-decoration: none;
            transition: transform 0.3s ease;
        }
        .course-link:hover, .enroll-button:hover {
            transform: scale(1.05);
            background: #01579B;
        }
        .try-it-btn, .voice-btn {
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: transform 0.3s ease;
            color: white;
        }
        .try-it-btn {
            background: #2E7D32;
        }
        .try-it-btn:hover {
            transform: scale(1.05);
            background: #1B5E20;
        }
        .voice-btn {
            background: #0288D1;
        }
        .voice-btn:hover {
            transform: scale(1.05);
            background: #01579B;
        }
        .email-btn {
            background: #0288D1;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 0.95rem;
            text-decoration: none;
            transition: transform 0.3s ease;
        }
        .email-btn:hover {
            transform: scale(1.05);
            background: #01579B;
        }
        .chart-container {
            min-height: 300px;
            max-width: 100%;
        }
        #score-breakdown-chart, #compare-others-chart {
            width: 100%;
            height: 300px;
        }
        .footer {
            margin-top: 20px;
            text-align: center;
            color: #333;
        }
        .footer a {
            color: #0288D1;
            text-decoration: none;
            margin: 0 10px;
        }
        .footer a:hover {
            text-decoration: underline;
        }
        .social-icons a {
            font-size: 1.2rem;
            margin: 0 10px;
            color: #0288D1;
        }
        .social-icons a:hover {
            color: #2E7D32;
        }
        @media (max-width: 600px) {
            body { padding: 10px; }
            .card-header { font-size: 1.4rem; padding: 1rem; }
            .card-body { padding: 1rem; }
            .info-box, .score-box, .badge-box, .learning-box { font-size: 0.9rem; padding: 8px; }
            .tips-list li { font-size: 0.9rem; padding: 8px; }
            .btn-primary, .btn-secondary, .btn-back { padding: 10px 20px; font-size: 0.9rem; }
            .badge { font-size: 0.8rem; padding: 6px 10px; }
            #score-breakdown-chart, #compare-others-chart { height: 220px; }
            .progress-tracker { gap: 10px; }
            .step { width: 30px; height: 30px; font-size: 1rem; }
            .email-btn { font-size: 0.85rem; padding: 6px 12px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="my-4">
            <div class="logo-container">
                <img src="{{ url_for('static', filename='img/ficore_logo.png') }}" alt="{{ translations[language]['Ficore Africa Logo'] or 'Ficore Africa Logo' }}" class="img-fluid">
            </div>
            <h1>{{ translations[language]['Your Financial Health Dashboard'] or 'Your Financial Health Dashboard' }}</h1>
        </header>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="alert-container my-3">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ 'danger' if category == 'error' else 'warning' if category == 'warning' else 'success' }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="{{ translations[language]['Close'] or 'Close' }}"></button>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            {% for i in range(1, 7) %}
                <div class="step {% if step > i %}completed{% elif step == i %}active{% endif %}">{{ i }}</div>
            {% endfor %}
        </div>

        <!-- Step 1: Welcome and Financial Health Score -->
        {% if step == 1 %}
            <div class="card">
                <div class="card-header">🎉 {{ translations[language]['Welcome'] or 'Welcome' }}, {{ first_name }}!</div>
                <div class="card-body light-blue">
                    <div class="info-box">{{ translations[language]['Submission Success'] or 'Your financial health data has been successfully submitted.' }}</div>
                    <div class="info-box">{{ translations[language]['Email'] or 'Email' }}: {{ email }}</div>
                    <div class="score-box">
                        <h3>⭐ {{ translations[language]['Your Financial Health Score'] or 'Your Financial Health Score' }}</h3>
                        <p>{{ health_score|round(1) }}/100</p>
                    </div>
                    <div class="info-box">{{ translations[language]['Ranked'] or 'Ranked' }} #{{ rank }} {{ translations[language]['out of'] or 'out of' }} {{ total_users }} {{ translations[language]['users'] or 'users' }}</div>
                    <div class="info-box">
                        {% if health_score >= 75 %}
                            {{ translations[language]['Strong Financial Health'] or 'Strong Financial Health' }}
                        {% elif health_score >= 50 %}
                            {{ translations[language]['Stable Finances'] or 'Stable Finances' }}
                        {% elif health_score >= 25 %}
                            {{ translations[language]['Financial Strain'] or 'Financial Strain' }}
                        {% else %}
                            {{ translations[language]['Urgent Attention Needed'] or 'Urgent Attention Needed' }}
                        {% endif %}
                    </div>
                    <div class="info-box">{{ translations[language]['Check Inbox'] or 'Check your inbox for a detailed report.' }}</div>
                    <div class="d-flex flex-wrap justify-content-center gap-2">
                        <a href="{{ url_for('health_score_submit', step=2) }}" class="btn btn-primary" aria-label="{{ translations[language]['Next'] or 'Next' }}">{{ translations[language]['Next'] or 'Next' }}</a>
                        <a href="{{ url_for('home') }}" class="btn btn-back" aria-label="{{ translations[language]['Back to Home'] or 'Back to Home' }}">{{ translations[language]['Back to Home'] or 'Back to Home' }}</a>
                        <button class="voice-btn" onclick="alert('{{ translations[language]['Voice guidance coming soon!'] or 'Voice guidance coming soon!' }}')" aria-label="{{ translations[language]['Listen to Voice Guidance'] or 'Listen to Voice Guidance' }}">🎙️ {{ translations[language]['Listen'] or 'Listen' }}</button>
                    </div>
                </div>
            </div>
        {% endif %}

        <!-- Step 2: Score Breakdown -->
        {% if step == 2 %}
            <div class="card">
                <div class="card-header">📊 {{ translations[language]['Score Breakdown'] or 'Score Breakdown' }}</div>
                <div class="card-body light-blue">
                    {% if breakdown_plot %}
                        <div class="chart-container">
                            <div id="score-breakdown-chart"></div>
                        </div>
                    {% else %}
                        <div class="info-box">{{ translations[language]['Chart Unavailable'] or 'Chart unavailable due to data issues.' }}</div>
                    {% endif %}
                    <div class="score-box">
                        <h4>{{ translations[language]['Score Composition'] or 'Score Composition' }}:</h4>
                        <ul>
                            <li><strong>{{ translations[language]['Cash Flow'] or 'Cash Flow' }}</strong>: {{ (user_data['income_revenue'] - user_data['expenses_costs'])|round(2) }} ₦</li>
                            <li><strong>{{ translations[language]['Debt-to-Income Ratio'] or 'Debt-to-Income Ratio' }}</strong>: {{ ((user_data['debt_loan'] / user_data['income_revenue'] * 100) if user_data['income_revenue'] > 0 else 0)|round(1) }}%</li>
                            <li><strong>{{ translations[language]['Debt Interest Burden'] or 'Debt Interest Burden' }}</strong>: {{ translations[language]['Debt Interest Description'] or 'Based on your debt interest rate.' }}</li>
                        </ul>
                        <p>
                            {% if health_score >= 75 %}
                                {{ translations[language]['Balanced Components'] or 'Your financial components are well-balanced.' }}
                            {% elif health_score >= 50 %}
                                {{ translations[language]['Components Need Attention'] or 'Some components need attention to improve your score.' }}
                            {% else %}
                                {{ translations[language]['Components Indicate Challenges'] or 'Your components indicate financial challenges.' }}
                            {% endif %}
                        </p>
                    </div>
                    <div class="d-flex flex-wrap justify-content-center gap-2">
                        <a href="{{ url_for('health_score_submit', step=3) }}" class="btn btn-primary" aria-label="{{ translations[language]['Next'] or 'Next' }}">{{ translations[language]['Next'] or 'Next' }}</a>
                        <a href="{{ url_for('health_score_submit', step=1) }}" class="btn btn-secondary" aria-label="{{ translations[language]['Back'] or 'Back' }}">{{ translations[language]['Back'] or 'Back' }}</a>
                        <a href="{{ url_for('home') }}" class="btn btn-back" aria-label="{{ translations[language]['Back to Home'] or 'Back to Home' }}">{{ translations[language]['Back to Home'] or 'Back to Home' }}</a>
                        <button class="voice-btn" onclick="alert('{{ translations[language]['Voice guidance coming soon!'] or 'Voice guidance coming soon!' }}')" aria-label="{{ translations[language]['Listen to Voice Guidance'] or 'Listen to Voice Guidance' }}">🎙️ {{ translations[language]['Listen'] or 'Listen' }}</button>
                    </div>
                </div>
            </div>
        {% endif %}

        <!-- Step 3: Badges and Recommended Learning -->
        {% if step == 3 %}
            <div class="card">
                <div class="card-header">🏅 {{ translations[language]['Your Badges'] or 'Your Badges' }}</div>
                <div class="card-body">
                    <div class="badge-box">
                        {% if badges %}
                            {% for badge in badges %}
                                <span class="badge" onclick="alert('{{ translations[language].get(badge, badge) }}: {{ translations[language]['Congratulations!'] or 'Congratulations!' }}')" aria-label="{{ translations[language].get(badge, badge) }}">{{ translations[language].get(badge, badge) }}</span>
                            {% endfor %}
                        {% else %}
                            <p>{{ translations[language]['No Badges Yet'] or 'No badges earned yet. Keep improving!' }}</p>
                        {% endif %}
                    </div>
                    <div class="learning-box">
                        <h3>📚 {{ translations[language]['Recommended Learning'] or 'Recommended Learning' }}</h3>
                        <div class="d-flex flex-wrap justify-content-center gap-2">
                            <a href="{{ course_url }}" target="_blank" class="course-link" aria-label="{{ translations[language]['View Course'] or 'View Course' }}">{{ course_title or translations[language]['Financial Health Course'] or 'Financial Health Course' }}</a>
                            <a href="{{ course_url }}" target="_blank" class="enroll-button" aria-label="{{ translations[language]['Enroll Now'] or 'Enroll Now' }}">{{ translations[language]['Enroll Now'] or 'Enroll Now' }}</a>
                        </div>
                    </div>
                    <div class="d-flex flex-wrap justify-content-center gap-2">
                        <a href="{{ url_for('health_score_submit', step=4) }}" class="btn btn-primary" aria-label="{{ translations[language]['Next'] or 'Next' }}">{{ translations[language]['Next'] or 'Next' }}</a>
                        <a href="{{ url_for('health_score_submit', step=2) }}" class="btn btn-secondary" aria-label="{{ translations[language]['Back'] or 'Back' }}">{{ translations[language]['Back'] or 'Back' }}</a>
                        <a href="{{ url_for('home') }}" class="btn btn-back" aria-label="{{ translations[language]['Back to Home'] or 'Back to Home' }}">{{ translations[language]['Back to Home'] or 'Back to Home' }}</a>
                        <button class="voice-btn" onclick="alert('{{ translations[language]['Voice guidance coming soon!'] or 'Voice guidance coming soon!' }}')" aria-label="{{ translations[language]['Listen to Voice Guidance'] or 'Listen to Voice Guidance' }}">🎙️ {{ translations[language]['Listen'] or 'Listen' }}</button>
                    </div>
                </div>
            </div>
        {% endif %}

        <!-- Step 4: Quick Financial Tips -->
        {% if step == 4 %}
            <div class="card">
                <div class="card-header">💡 {{ translations[language]['Quick Financial Tips'] or 'Quick Financial Tips' }}</div>
                <div class="card-body">
                    <ul class="tips-list learning-box">
                        {% if health_score >= 75 %}
                            <li>
                                <span><strong>{{ translations[language]['Invest'] or 'Invest' }}</strong>: {{ translations[language]['Invest Wisely'] or 'Consider investing surplus funds wisely.' }}</span>
                                <button class="try-it-btn" onclick="alert('{{ translations[language]['Explore investment options.'] or 'Explore investment options.' }}')" aria-label="{{ translations[language]['Try Investing'] or 'Try Investing' }}">{{ translations[language]['Try It'] or 'Try It' }}</button>
                            </li>
                            <li>
                                <span><strong>{{ translations[language]['Scale'] or 'Scale' }}</strong>: {{ translations[language]['Scale Smart'] or 'Scale your business or finances smartly.' }}</span>
                                <button class="try-it-btn" onclick="alert('{{ translations[language]['Plan for scalable growth.'] or 'Plan for scalable growth.' }}')" aria-label="{{ translations[language]['Try Scaling'] or 'Try Scaling' }}">{{ translations[language]['Try It'] or 'Try It' }}</button>
                            </li>
                        {% elif health_score >= 50 %}
                            <li>
                                <span><strong>{{ translations[language]['Build'] or 'Build' }}</strong>: {{ translations[language]['Build Savings'] or 'Focus on building your savings.' }}</span>
                                <button class="try-it-btn" onclick="alert('{{ translations[language]['Start a savings plan.'] or 'Start a savings plan.' }}')" aria-label="{{ translations[language]['Try Building Savings'] or 'Try Building Savings' }}">{{ translations[language]['Try It'] or 'Try It' }}</button>
                            </li>
                            <li>
                                <span><strong>{{ translations[language]['Cut'] or 'Cut' }}</strong>: {{ translations[language]['Cut Costs'] or 'Identify and cut unnecessary costs.' }}</span>
                                <button class="try-it-btn" onclick="alert('{{ translations[language]['Review your expenses.'] or 'Review your expenses.' }}')" aria-label="{{ translations[language]['Try Cutting Costs'] or 'Try Cutting Costs' }}">{{ translations[language]['Try It'] or 'Try It' }}</button>
                            </li>
                        {% else %}
                            <li>
                                <span><strong>{{ translations[language]['Reduce'] or 'Reduce' }}</strong>: {{ translations[language]['Reduce Debt'] or 'Prioritize reducing your debt.' }}</span>
                                <button class="try-it-btn" onclick="alert('{{ translations[language]['Create a debt repayment plan.'] or 'Create a debt repayment plan.' }}')" aria-label="{{ translations[language]['Try Reducing Debt'] or 'Try Reducing Debt' }}">{{ translations[language]['Try It'] or 'Try It' }}</button>
                            </li>
                            <li>
                                <span><strong>{{ translations[language]['Boost'] or 'Boost' }}</strong>: {{ translations[language]['Boost Income'] or 'Explore ways to boost your income.' }}</span>
                                <button class="try-it-btn" onclick="alert('{{ translations[language]['Consider side hustles or new revenue streams.'] or 'Consider side hustles or new revenue streams.' }}')" aria-label="{{ translations[language]['Try Boosting Income'] or 'Try Boosting Income' }}">{{ translations[language]['Try It'] or 'Try It' }}</button>
                            </li>
                        {% endif %}
                    </ul>
                    <div class="d-flex flex-wrap justify-content-center gap-2">
                        <a href="{{ url_for('health_score_submit', step=5) }}" class="btn btn-primary" aria-label="{{ translations[language]['Next'] or 'Next' }}">{{ translations[language]['Next'] or 'Next' }}</a>
                        <a href="{{ url_for('health_score_submit', step=3) }}" class="btn btn-secondary" aria-label="{{ translations[language]['Back'] or 'Back' }}">{{ translations[language]['Back'] or 'Back' }}</a>
                        <a href="{{ url_for('home') }}" class="btn btn-back" aria-label="{{ translations[language]['Back to Home'] or 'Back to Home' }}">{{ translations[language]['Back to Home'] or 'Back to Home' }}</a>
                        <button class="voice-btn" onclick="alert('{{ translations[language]['Voice guidance coming soon!'] or 'Voice guidance coming soon!' }}')" aria-label="{{ translations[language]['Listen to Voice Guidance'] or 'Listen to Voice Guidance' }}">🎙️ {{ translations[language]['Listen'] or 'Listen' }}</button>
                    </div>
                </div>
            </div>
        {% endif %}

        <!-- Step 5: How You Compare to Others -->
        {% if step == 5 %}
            <div class="card">
                <div class="card-header">⚖️ {{ translations[language]['How You Compare'] or 'How You Compare' }}</div>
                <div class="card-body light-blue">
                    {% if comparison_plot %}
                        <div class="chart-container">
                            <div id="compare-others-chart"></div>
                        </div>
                    {% else %}
                        <div class="info-box">{{ translations[language]['Chart Unavailable'] or 'Chart unavailable due to data issues.' }}</div>
                    {% endif %}
                    <div class="info-box">
                        {{ translations[language]['Your Rank'] or 'Your Rank' }} #{{ rank }} {{ translations[language]['out of'] or 'out of' }} {{ total_users }} {{ translations[language]['users'] or 'users' }} {{ translations[language]['places you'] or 'places you' }}:
                        {% if rank <= total_users * 0.1 %}
                            {{ translations[language]['Top 10%'] or 'Top 10%' }}
                        {% elif rank <= total_users * 0.3 %}
                            {{ translations[language]['Top 30%'] or 'Top 30%' }}
                        {% elif rank <= total_users * 0.7 %}
                            {{ translations[language]['Middle Range'] or 'Middle Range' }}
                        {% else %}
                            {{ translations[language]['Lower Range'] or 'Lower Range' }}
                        {% endif %}
                        {{ translations[language]['Regular Submissions'] or 'Regular submissions can improve your ranking.' }}
                    </div>
                    <div class="d-flex flex-wrap justify-content-center gap-2">
                        <a href="{{ url_for('health_score_submit', step=6) }}" class="btn btn-primary" aria-label="{{ translations[language]['Next'] or 'Next' }}">{{ translations[language]['Next'] or 'Next' }}</a>
                        <a href="{{ url_for('health_score_submit', step=4) }}" class="btn btn-secondary" aria-label="{{ translations[language]['Back'] or 'Back' }}">{{ translations[language]['Back'] or 'Back' }}</a>
                        <a href="{{ url_for('home') }}" class="btn btn-back" aria-label="{{ translations[language]['Back to Home'] or 'Back to Home' }}">{{ translations[language]['Back to Home'] or 'Back to Home' }}</a>
                        <button class="voice-btn" onclick="alert('{{ translations[language]['Voice guidance coming soon!'] or 'Voice guidance coming soon!' }}')" aria-label="{{ translations[language]['Listen to Voice Guidance'] or 'Listen to Voice Guidance' }}">🎙️ {{ translations[language]['Listen'] or 'Listen' }}</button>
                    </div>
                </div>
            </div>
        {% endif %}

        <!-- Step 6: What’s Next? -->
        {% if step == 6 %}
            <div class="card">
                <div class="card-header">🔓 {{ translations[language]['Whats Next'] or 'What’s Next?' }}</div>
                <div class="card-body">
                    <div class="d-flex flex-wrap justify-content-center gap-2 mb-3">
                        <a href="{{ FEEDBACK_FORM_URL }}" class="btn btn-secondary" aria-label="{{ translations[language]['Provide Feedback'] or 'Provide Feedback' }}">{{ translations[language]['Provide Feedback'] or 'Provide Feedback' }}</a>
                        <a href="{{ WAITLIST_FORM_URL }}" class="btn btn-secondary" aria-label="{{ translations[language]['Join Waitlist'] or 'Join Waitlist' }}">{{ translations[language]['Join Waitlist'] or 'Join Waitlist' }}</a>
                        <a href="{{ CONSULTANCY_FORM_URL }}" class="btn btn-secondary" aria-label="{{ translations[language]['Book Consultancy'] or 'Book Consultancy' }}">{{ translations[language]['Book Consultancy'] or 'Book Consultancy' }}</a>
                    </div>
                    <div class="info-box">
                        {{ translations[language]['Contact Us'] or 'Contact Us' }} 
                        <a href="mailto:support@ficoreafrica.com" class="email-btn" aria-label="{{ translations[language]['Email Support'] or 'Email Support' }}">{{ translations[language]['Email Us'] or 'Email Us' }}</a> 
                        {{ translations[language]['for support'] or 'for support' }} | 
                        {{ translations[language]['Follow us on'] or 'Follow us on' }} 
                        <a href="{{ LINKEDIN_URL }}" target="_blank" aria-label="LinkedIn"><i class="fab fa-linkedin"></i> LinkedIn</a> 
                        {{ translations[language]['and'] or 'and' }} 
                        <a href="{{ TWITTER_URL }}" target="_blank" aria-label="Twitter"><i class="fab fa-twitter"></i> Twitter</a>
                    </div>
                    <div class="d-flex flex-wrap justify-content-center gap-2">
                        <a href="{{ url_for('home') }}" class="btn btn-primary no-arrow" aria-label="{{ translations[language]['Back to Home'] or 'Back to Home' }}">{{ translations[language]['Back to Home'] or 'Back to Home' }}</a>
                        <button class="voice-btn" onclick="alert('{{ translations[language]['Voice guidance coming soon!'] or 'Voice guidance coming soon!' }}')" aria-label="{{ translations[language]['Listen to Voice Guidance'] or 'Listen to Voice Guidance' }}">🎙️ {{ translations[language]['Listen'] or 'Listen' }}</button>
                    </div>
                </div>
            </div>
        {% endif %}

        <!-- Footer -->
        <footer class="footer">
            <p>{{ translations[language]['About Ficore Africa: Empowering financial growth across Africa since 2023'] or 'About Ficore Africa: Empowering financial growth across Africa since 2023' }}</p>
            <div class="social-icons">
                <a href="{{ LINKEDIN_URL }}" target="_blank" aria-label="LinkedIn"><i class="fab fa-linkedin"></i></a>
                <a href="{{ TWITTER_URL }}" target="_blank" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
            </div>
            <p>
                <a href="mailto:support@ficoreafrica.com">{{ translations[language]['Click to Email'] or 'Click to Email' }} {{ translations[language]['for support'] or 'for support' }}</a> |
                <a href="{{ FEEDBACK_FORM_URL }}" target="_blank">{{ translations[language]['Provide Feedback'] or 'Provide Feedback' }}</a>
            </p>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Chart Data
        const userData = {{ user_data | tojson }};
        const healthScore = {{ health_score | tojson }};
        const peerData = { averageScore: {{ total_users > 0 ? (all_users_df['HealthScore'].mean() if 'all_users_df' in globals() else 50) : 50 | tojson }} };
        const language = '{{ language }}';
        const translations = {{ translations[language] | tojson }};

        const chartTranslations = {
            'en': {
                'Income': 'Income',
                'Expenses': 'Expenses',
                'Debt': 'Debt',
                'Amount': 'Amount (₦)',
                'Your Score': 'Your Score',
                'Average Peer Score': 'Average Peer Score',
                'Financial Health Score': 'Financial Health Score'
            },
            'ha': {
                'Income': 'Kuɗin Shiga',
                'Expenses': 'Kashe Kuɗi',
                'Debt': 'Bashi',
                'Amount': 'Adadin (₦)',
                'Your Score': 'Makin Ku',
                'Average Peer Score': 'Matsakaicin Makin Sauran Mutane',
                'Financial Health Score': 'Makin Lafiyar Kuɗi'
            }
        };
        const labels = chartTranslations[language] || chartTranslations['en'];

        // Score Breakdown Chart
        {% if breakdown_plot %}
            const scoreBreakdownData = [{
                x: [userData['income_revenue'] || 0, userData['expenses_costs'] || 0, userData['debt_loan'] || 0],
                y: [labels['Income'], labels['Expenses'], labels['Debt']],
                type: 'bar',
                orientation: 'h',
                marker: { color: ['#2E7D32', '#0288D1', '#DC3545'] },
                text: [userData['income_revenue'] || 0, userData['expenses_costs'] || 0, userData['debt_loan'] || 0].map(v => `₦${v.toLocaleString()}`),
                textposition: 'auto',
                hoverinfo: 'text+x'
            }];
            Plotly.newPlot('score-breakdown-chart', scoreBreakdownData, {
                xaxis: { title: labels['Amount'] },
                yaxis: { title: '' },
                height: 300,
                margin: { l: 80, r: 20, t: 20, b: 50 },
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)'
            }, { responsive: true });
        {% endif %}

        // Compare Others Chart
        {% if comparison_plot %}
            const compareOthersData = [{
                x: [labels['Your Score'], labels['Average Peer Score']],
                y: [healthScore || 0, peerData.averageScore || 50],
                type: 'bar',
                marker: { color: ['#2E7D32', '#6C757D'] },
                text: [healthScore || 0, peerData.averageScore || 50].map(v => `${v.toFixed(1)}/100`),
                textposition: 'auto',
                hoverinfo: 'text+y'
            }];
            Plotly.newPlot('compare-others-chart', compareOthersData, {
                xaxis: { title: '' },
                yaxis: { title: labels['Financial Health Score'], range: [0, 100] },
                height: 300,
                margin: { l: 50, r: 20, t: 20, b: 50 },
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)'
            }, { responsive: true });
        {% endif %}
    </script>
</body>
</html>
